<!--   A Spa Theory experience
* * *  ／(･ × ･)＼ ✿ ／(˃ᆺ˂)＼ ✿ ／(^ × ^)＼
* * *  http://spatheory.co
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Macy Rodman × Spa Theory : Endless Kindness Experience</title>
    <script src="/js/shader-frog.js"></script>
  </head>
  <body>
    <a-scene dust-test>
        <a-assets>
            <!-- ASSETS -->
            <!-- 3D MODELS -->
            <a-asset-item id="macy-obj" src="assets/models/macy-idol/macy_sample.obj"></a-asset-item>
            <!-- <a-asset-item id="macy-mtl" src="assets/models/macy-idol/macy_sample.mtl"></a-asset-item> -->

            <!-- SHADERS -->
            <!-- <a-asset-item id="cloud" src="shaders/CloudsPlane.json"></a-asset-item> -->

            <!-- PLANE THUMBNAILS -->
            <img id="plane-01" src="assets/Plane-01.png">
            <img id="plane-02" src="assets/Plane-02.png">
            <img id="plane-03" src="assets/Plane-03.png">

            <!-- TEST GRADIENTS -->
            <img id="grad-01" src="assets/gradients/EK_testgradients-01.png">
            <img id="grad-02" src="assets/gradients/EK_testgradients-02.png">
            <img id="grad-03" src="assets/gradients/EK_testgradients-03.png">
            <img id="grad-04" src="assets/gradients/EK_testgradients-04.png">

            <!---->
    
          </a-assets>

      <!-- camera -->
      <!-- <a-entity id="player"> -->
          <a-entity id="camera" position="0 100 3000" listener="stepFactor:0.075" camera wasd-controls="acceleration: 2000" look-controls>
              <a-entity 
              raycaster="objects: .collidable"
              cursor="fuse: true; fuseTimeout: 500; rayOrigin: mouse;"
              position="0 0.07 -0.5"
              geometry="primitive: ring; radiusInner: 0.005; radiusOuter: 0.008;"
              material="color: black; shader: flat"
              >
              </a-entity>
              <a-entity obj-model="obj: #macy-obj; mtl: #macy-mtl" rotation="-60 0 0" position="0 -48 -50" scale="0.5 0.5 0.5"></a-entity> 
          </a-entity> 
      <!-- </a-entity> -->
 
      </a-entity>
          <!-- <a-entity camera look-controls orbit-controls="target: 0 5 750; minDistance: 250; maxDistance: 7500; initialPosition: 0 500 750; rotateSpeed: 0.25; enablePan: true;">

          </a-entity> -->

          

      <!-- minime -->
      <a-entity rotation="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 20000">
          <a-entity obj-model="obj: #macy-obj; mtl: #macy-mtl" rotation="-60 0 0" scale="0.5 0.5 0.5" position="500 500 500"></a-entity> 
      </a-entity>

      <a-entity rotation="0 0 0" animation="property: rotation; to: 0 -360 0; loop: true; dur: 30000" animation__up="property: position; to: 0 25 0; dur: 2500; easing: easeInOutSine; dir: alternate; loop: true;">
          <a-entity obj-model="obj: #macy-obj; mtl: #macy-mtl" rotation="-60 0 45" scale="0.5 0.5 0.5" position="900 900 900"></a-entity> 
      </a-entity>

      <!-- idol -->
      <a-entity class="collidable" position="0 -2500 0" rotation="0 180 0" scale="23 23 23">
          <a-entity obj-model="obj: #macy-obj;" shader-frog="name:Electric_Shader"></a-entity>
          <!-- <a-entity scale="10 10 10" fbx-model="src: url(#macy-fbx);">
          </a-entity> -->
      </a-entity>

      <a-sphere shadow
      shader-frog="name:Electric_Shader" 
      radius="100"
      position="1500 250 -50">
</a-sphere>


      <!-- sky -->
      <a-sphere 
        scale="7500 7500 7500"
        material="metalness:1; roughness: 0; sphericalEnvMap: #grad-02; side: double;" position="0 0 0">
      </a-sphere>  

      <!-- environmental -->
      <a-dust num-points="2000" dispersion="150" color="white" log=false></a-dust>

    </a-scene>
    <script type="text/javascript">
      // AFRAME.registerComponent("listener", {
      //   schema : 
      //   {
      //     stepFactor : {
      //       type : "number",
      //       default : 0.05
      //     }
      //   },
      //   tick : function(){	
      //     this.el.components.camera.camera.parent.position.add(this.el.components.camera.camera.getWorldDirection().multiplyScalar(this.data.stepFactor));
      //     // console.log("tick");
      //   }
      // });

      // RAYCASTER CHECK
      AFRAME.registerComponent('collider-check', {
        dependencies: ['raycaster'],

        init: function () {
          this.el.addEventListener('raycaster-intersection', function () {
            console.log('Player hit something!');
          });
        }
      });

      // DUST

      AFRAME.registerComponent('dust-test', {
            init: function () {
                let sceneEl = this.el;
                console.log("dust-test init");

                let cameraEl = sceneEl.querySelector('[camera]');
                let dustEl = sceneEl.querySelector('a-dust');

                // delays setup until there's some slack time
                requestIdleCallback( () => {
                    dustEl.components.dust.setCamera(cameraEl);
                });
            }
        });
    </script>
  </body>
</html>
